<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>突变氨基酸分布图</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    canvas {
      max-width: 500px;
      margin: 20px auto;
    }
    form {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-bottom: 20px;
    }
    input[type="number"] {
      width: 60px;
    }
    label {
      font-size: 14px;
    }
    #chartContainer {
      display: flex;
      justify-content: center;
    }
  </style>
</head>
<body>
  <h2>突变氨基酸数量输入</h2>
  <form id="dataForm">
    <!-- 生成 20 个氨基酸输入 -->
  </form>
  <button onclick="updateChart()">生成图表</button>
  <div id="chartContainer">
    <canvas id="aminoPieChart"></canvas>
  </div>

  <script>
    const aminoAcids = [
      'Ala', 'Arg', 'Asn', 'Asp', 'Cys',
      'Gln', 'Glu', 'Gly', 'His', 'Ile',
      'Leu', 'Lys', 'Met', 'Phe', 'Pro',
      'Ser', 'Thr', 'Trp', 'Tyr', 'Val'
    ];

    const simpsonsColors = [
      '#FED766', '#FE4A49', '#2AB7CA', '#E6E6EA', '#F6ABB6',
      '#007849', '#FFA400', '#E63946', '#6A0572', '#3A86FF',
      '#8338EC', '#FF006E', '#FB5607', '#FFBE0B', '#06D6A0',
      '#118AB2', '#EF476F', '#073B4C', '#FF9F1C', '#A8DADC'
    ];

    const form = document.getElementById('dataForm');
    aminoAcids.forEach((aa, i) => {
      const label = document.createElement('label');
      label.innerHTML = `${aa}: <input type="number" name="${aa}" value="0" min="0">`;
      form.appendChild(label);
    });

    const ctx = document.getElementById('aminoPieChart').getContext('2d');
    let chart;

    function updateChart() {
      const formData = new FormData(form);
      const values = aminoAcids.map(aa => parseInt(formData.get(aa)) || 0);

      if (chart) chart.destroy();

      const data = {
        labels: aminoAcids,
        datasets: [{
          data: values,
          backgroundColor: simpsonsColors
        }]
      };

      chart = new Chart(ctx, {
        type: 'pie',
        data: data,
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                generateLabels: function(chart) {
                  const original = Chart.defaults.plugins.legend.labels.generateLabels(chart);
                  return original.map((label, i) => {
                    label.text = chart.data.labels[i];
                    return label;
                  });
                }
              }
            },
            tooltip: {
              callbacks: {
                label: function(tooltipItem) {
                  const label = tooltipItem.label || '';
                  const value = tooltipItem.raw;
                  const total = tooltipItem.dataset.data.reduce((a, b) => a + b, 0);
                  const percent = total ? ((value / total) * 100).toFixed(2) : 0;
                  return `${label}: ${value} (${percent}%)`;
                }
              }
            },
            title: {
              display: true,
              text: '突变氨基酸数目分布'
            }
          }
        }
      });
    }
  </script>
</body>
</html>
